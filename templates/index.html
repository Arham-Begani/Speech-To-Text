<!DOCTYPE html>
<html>
<head>
    <title>Voice to Text</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Voice to Text</h1>
    <div id="status">Idle</div>
    <button onclick="startListening()">Start Listening</button>
    <div id="result"></div>

    <script>
        let results = [];

        function startListening() {
            const statusEl = document.getElementById("status");
            const micBtn = document.getElementById("mic-btn");

            statusEl.innerText = "Listening...";
            statusEl.className = "status listening";
            micBtn.classList.add("active");

            fetch("/listen")
                .then(res => res.json())
                .then(data => {
                    micBtn.classList.remove("active");

                    if (data.status === "success") {
                        statusEl.innerText = "✅ Done";
                        statusEl.className = "status success";
                        results.push(data.text);
                    } else {
                        statusEl.innerText = "❌ Error";
                        statusEl.className = "status error";
                        results.push(data.text);
                    }

                    renderResults();
                })
                .catch(err => {
                    statusEl.innerText = "❌ Error";
                    statusEl.className = "status error";
                    micBtn.classList.remove("active");
                });
        }

        function renderResults() {
            const list = document.getElementById("result-list");
            list.innerHTML = results.map((text, i) => `<div class="result-item">${i+1}. ${text}</div>`).join("");
            list.scrollTop = list.scrollHeight;
        }
    </script>
    
</body>
</html>
